<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>

    <style type="text/css">
    body,html{
        margin: 0px;
        padding: 0px;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    .ytp-title, .ytp-chrome-top-buttons, .ytp-watermark, .ytp-large-play-button{
        display: none;
    }   
    #mensaje {
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        position: fixed;
        top: 0;
        left: 0;
        text-align: center;
        line-height: 62;
    }    
    .hidden{
        display: none;
    }
    .show{
        display:block !important;
    }
    .control{
        cursor: pointer;
    }
    .btn_circulo{
        border-radius: 50%;
        padding: 7px;
        font-family: sans-serif;
        background: black;
        color:white;
        display: inline;
        cursor: pointer;
    }
    .btn_circulo:hover{
        background:white;
        color:black;
    }
    .menu_secciones{
        position: fixed;
        bottom:20px;
        left: 50%;
        margin-left: -200px;
        width:400px;
        text-align: center;
    }
    </style>

</head>
<body>

    <div id="mensaje" class="hidden">
        <img src="img/Actions-go-previous-icon.png" class="control" onclick="izquierda();" alt="">
        &nbsp;&nbsp;&nbsp;
        <img src="img/Eye-icon.png" class="control" onclick="centro();" alt="">
        &nbsp;&nbsp;&nbsp; 
        <img src="img/Actions-go-next-icon.png" class="control" onclick="derecha();" alt="">
    </div>
    <nav class="menu_secciones">
        <div class="btn_circulo" onclick="cargarVideo(1);">1</div>
        <div class="btn_circulo" onclick="cargarVideo(2);">2</div>
        <div class="btn_circulo" onclick="cargarVideo(3);">3</div>
        <div class="btn_circulo" onclick="cargarVideo(4);">4</div>
        <div class="btn_circulo" onclick="cargarVideo(7);">7</div>
        <div class="btn_circulo" onclick="cargarVideo(10);">10</div>
        <div class="btn_circulo" onclick="cargarVideo(11);">11</div>
        <div class="btn_circulo" onclick="cargarVideo(12);">12</div>
    </nav>
    <div id="player"></div>
    
    <script>        
        
        let indice = 1;
        let decision = false;
        let interval_id;
        let video_actual;

        const videos = [];
        videos[1] =  {c:"g1", id:1,v:"IuZWszHATjI",d:false,s:2};
        videos[2] =  {c:"g2", id:2,v:"ESkM5cijr9M",d:false,s:3};
        videos[3] =  {c:"g3", id:3,v:"iS78b5S3BMM",d:false,s:4};
        videos[4] =  {c:"g4", id:4,v:"mKS_DZKLPIw",d:true,s:[5,6,7]};
        videos[5] =  {c:"g5a",id:5,v:"2cYyVdslpEw",d:false,s:4};
        videos[6] =  {c:"g5b",id:6,v:"YQ7IhAm8s9M",d:false,s:4};
        videos[7] =  {c:"g6", id:7,v:"QQyXh6SM_sU",d:true,s:[8,9,10]};
        videos[8] =  {c:"g6a",id:8,v:"eUJYq9SzLJ8",d:false,s:7};
        videos[9] =  {c:"g6b",id:9,v:"rvTJyPWAnHw",d:false,s:7};
        videos[10] = {c:"g7", id:10,v:"Lj_lYg9dHes",d:false,s:11};
        videos[11] = {c:"g8", id:11,v:"8IFJS_nTulg",d:false,s:12};
        videos[12] = {c:"g9", id:12,v:"fUfDBsZTK1g",d:false,s:-1};//Indica el fin
        
        // 2. This code loads the IFrame Player API code asynchronously.
        var tag = document.createElement('script');

        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 3. This function creates an <iframe> (and YouTube player)
        //    after the API code downloads.
        var player;
        function onYouTubeIframeAPIReady() {
            video_actual = videos[indice];
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: video_actual.v,
                playerVars:{ 'autoplay': 1, 'controls': 0, 'rel': 0, 'modestbranding':0, 'showinfo':0 },
                events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
                }
            });
        }

        // 4. The API will call this function when the video player is ready.
        function onPlayerReady(event) {
            event.target.playVideo();
        }

        function izquierda()
        {
            cargarVideo(video_actual.s[0]);
            ocultarMensaje();
        }

        function centro(){
            cargarVideo(video_actual.s[1]);
            ocultarMensaje();
        }

        function derecha(){
            cargarVideo(video_actual.s[2]);
            ocultarMensaje();
        }


        function cargarVideo(indice){
            if(indice>0){
                ocultarMensaje();
                video_actual = videos[indice];            
                player.loadVideoById(video_actual.v, 0, "default");
            }
            else{
                detenerVideo();
                alert("fin de la experiencia :)");
            }
        }
        
        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                empezarChequeo();                
            }
            if(event.data == YT.PlayerState.ENDED){
                cargarVideo(video_actual.s);
            }
        }

        function empezarChequeo()
        {
            detenerChequeo();
            interal_id = setInterval(() => {
                esperarAntesDelFinal(2);                
            }, 5000);
        }

        function detenerChequeo(){
            if(interval_id)
            {
                clearInterval(interval_id);
            }
        }

        function esperarAntesDelFinal(tiempo)
        {
            if(video_actual.d && ((player.getDuration()-player.getCurrentTime())<=tiempo))
            {
                mostrarMensaje();
            }
            console.log(video_actual.d+" tiempo total "+player.getDuration()+" tiempo actual "+player.getCurrentTime()+" diferencia "+(player.getDuration()-player.getCurrentTime()))
        }

        function ocultarMensaje()
        {
            mensaje.className = "hidden";
        }

        function mostrarMensaje()
        {
            mensaje.className = "show";
            detenerVideo();
            detenerChequeo();
        }
        function detenerVideo() {
            player.stopVideo();
        }


    </script>
</body>
</html>