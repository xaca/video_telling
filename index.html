<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>

    <style type="text/css">
    body,html{
        margin: 0px;
        padding: 0px;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    .ytp-title, .ytp-chrome-top-buttons, .ytp-watermark, .ytp-large-play-button{
        display: none;
    }   
    #mensaje {
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        position: fixed;
        top: 0;
        left: 0;
        border-radius: 5%;
        text-align: center;
        line-height: 62;
    }    
    .hidden{
        display: none;
    }
    .show{
        display:block !important;
    }
    </style>

</head>
<body>

    <div id="mensaje" class="hidden">
        <img src="img/Actions-go-previous-icon.png" onclick="izquierda();" alt="">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
        <img src="img/Actions-go-next-icon.png" onclick="derecha();" alt="">
    </div>
    <div id="player"></div>
    
    <script>        
        //"mKS_DZKLPIw",
        const videos = [{v:"IuZWszHATjI",d:false},{v:"ESkM5cijr9M",d:false},{v:"iS78b5S3BMM",d:true},{v:"2cYyVdslpEw",d:false},{v:"YQ7IhAm8s9M",d:false},{v:"QQyXh6SM_sU",d:true},{v:"eUJYq9SzLJ8",d:false},{v:"rvTJyPWAnHw",d:false},{v:"Lj_lYg9dHes",d:true},{v:"8IFJS_nTulg",d:false},{v:"fUfDBsZTK1g",d:false}];
        let indice = 0;
        let decision = false;
        let interval_id;

        // 2. This code loads the IFrame Player API code asynchronously.
        var tag = document.createElement('script');

        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 3. This function creates an <iframe> (and YouTube player)
        //    after the API code downloads.
        var player;
        function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '100%',
            width: '100%',
            videoId: videos[0].v,
            playerVars:{ 'autoplay': 1, 'controls': 0, 'rel': 0, 'modestbranding':0, 'showinfo':0 },
            events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
            }
        });
        }

        // 4. The API will call this function when the video player is ready.
        function onPlayerReady(event) {
            event.target.playVideo();
        }

        function izquierda()
        {
            cargarSiguenteVideo(1);
            ocultarMensaje();
        }

        function derecha(){
            cargarSiguenteVideo(2);
            ocultarMensaje();
        }

        function siguienteIndice(valor)
        {
            if(indice+1 < videos.length)
            {
                indice+=valor;
            }
            return indice;
        }

        function cargarSiguenteVideo(indice){
            let obj = videos[siguienteIndice(indice)];
            decision = obj.d; console.log("decision "+decision);
            player.loadVideoById(obj.v, 0, "default");
        }
        
        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                empezarChequeo();
            }
            if(event.data == YT.PlayerState.ENDED){
                cargarSiguenteVideo(1);
            }
            
        }

        function empezarChequeo()
        {
            detenerChequeo();
            interal_id = setInterval(() => {
                esperarAntesDelFinal(2);                
            }, 1000);
        }

        function detenerChequeo(){
            if(interval_id)
            {
                clearInterval(interval_id);
            }
        }

        function esperarAntesDelFinal(tiempo)
        {
            if(decision && ((player.getDuration()-player.getCurrentTime())<=tiempo))
            {
                mostrarMensaje();
            }
            console.log(decision+" tiempo total "+player.getDuration()+" tiempo actual "+player.getCurrentTime()+" diferencia "+(player.getDuration()-player.getCurrentTime()))
        }

        function ocultarMensaje()
        {
            mensaje.className = "hidden";
        }

        function mostrarMensaje()
        {
            mensaje.className = "show";
            detenerVideo();
            detenerChequeo();
        }
        function detenerVideo() {
            player.stopVideo();
        }


    </script>
</body>
</html>